(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var YText;

YText = (function() {
  function YText(text) {
    this.textfields = [];
    if (text == null) {
      this._text = "";
    } else if (text.constructor === String) {
      this._text = text;
    } else {
      throw new Error("Y.Text expects a String as a constructor");
    }
  }

  YText.prototype._name = "Text";

  YText.prototype._getModel = function(types, ops) {
    if (this._model == null) {
      this._model = new ops.ListManager(this).execute();
      this.insert(0, this._text);
    }
    delete this._text;
    return this._model;
  };

  YText.prototype._setModel = function(_model) {
    this._model = _model;
    return delete this._text;
  };

  YText.prototype.val = function() {
    return this._model.fold("", function(left, o) {
      return left + o.val();
    });
  };

  YText.prototype.observe = function() {
    return this._model.observe.apply(this._model, arguments);
  };

  YText.prototype.unobserve = function() {
    return this._model.unobserve.apply(this._model, arguments);
  };

  YText.prototype.toString = function() {
    return this.val();
  };

  YText.prototype.insert = function(position, content) {
    var ith;
    if (content.constructor !== String) {
      throw new Error("Y.String.insert expects a String as the second parameter!");
    }
    if (typeof position !== "number") {
      throw new Error("Y.String.insert expects a Number as the first parameter!");
    }
    if (content.length > 0) {
      ith = this._model.getOperationByPosition(position);
      return this._model.insertAfter(ith, content);
    }
  };

  YText.prototype["delete"] = function(position, length) {
    return this._model["delete"](position, length);
  };

  YText.prototype.bind = function(textfield, dom_root) {
    var createRange, creator_token, t, word, writeContent, writeRange, _i, _len, _ref;
    if (dom_root == null) {
      dom_root = window;
    }
    if (dom_root.getSelection == null) {
      dom_root = window;
    }
    _ref = this.textfields;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      t = _ref[_i];
      if (t === textfield) {
        return;
      }
    }
    creator_token = false;
    word = this;
    textfield.value = this.val();
    this.textfields.push(textfield);
    if ((textfield.selectionStart != null) && (textfield.setSelectionRange != null)) {
      createRange = function(fix) {
        var left, right;
        left = textfield.selectionStart;
        right = textfield.selectionEnd;
        if (fix != null) {
          left = fix(left);
          right = fix(right);
        }
        return {
          left: left,
          right: right
        };
      };
      writeRange = function(range) {
        writeContent(word.val());
        return textfield.setSelectionRange(range.left, range.right);
      };
      writeContent = function(content) {
        return textfield.value = content;
      };
    } else {
      createRange = function(fix) {
        var clength, edited_element, range, s;
        range = {};
        s = dom_root.getSelection();
        clength = textfield.textContent.length;
        range.left = Math.min(s.anchorOffset, clength);
        range.right = Math.min(s.focusOffset, clength);
        if (fix != null) {
          range.left = fix(range.left);
          range.right = fix(range.right);
        }
        edited_element = s.focusNode;
        if (edited_element === textfield || edited_element === textfield.childNodes[0]) {
          range.isReal = true;
        } else {
          range.isReal = false;
        }
        return range;
      };
      writeRange = function(range) {
        var r, s, textnode;
        writeContent(word.val());
        textnode = textfield.childNodes[0];
        if (range.isReal && (textnode != null)) {
          if (range.left < 0) {
            range.left = 0;
          }
          range.right = Math.max(range.left, range.right);
          if (range.right > textnode.length) {
            range.right = textnode.length;
          }
          range.left = Math.min(range.left, range.right);
          r = document.createRange();
          r.setStart(textnode, range.left);
          r.setEnd(textnode, range.right);
          s = window.getSelection();
          s.removeAllRanges();
          return s.addRange(r);
        }
      };
      writeContent = function(content) {
        var c, content_array, i, _j, _len1, _results;
        content_array = content.replace(new RegExp("\n", 'g'), " ").split(" ");
        textfield.innerText = "";
        _results = [];
        for (i = _j = 0, _len1 = content_array.length; _j < _len1; i = ++_j) {
          c = content_array[i];
          textfield.innerText += c;
          if (i !== content_array.length - 1) {
            _results.push(textfield.innerHTML += '&nbsp;');
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      };
    }
    writeContent(this.val());
    this.observe(function(events) {
      var event, fix, o_pos, r, _j, _len1, _results;
      _results = [];
      for (_j = 0, _len1 = events.length; _j < _len1; _j++) {
        event = events[_j];
        if (!creator_token) {
          if (event.type === "insert") {
            o_pos = event.position;
            fix = function(cursor) {
              if (cursor <= o_pos) {
                return cursor;
              } else {
                cursor += 1;
                return cursor;
              }
            };
            r = createRange(fix);
            _results.push(writeRange(r));
          } else if (event.type === "delete") {
            o_pos = event.position;
            fix = function(cursor) {
              if (cursor < o_pos) {
                return cursor;
              } else {
                cursor -= 1;
                return cursor;
              }
            };
            r = createRange(fix);
            _results.push(writeRange(r));
          } else {
            _results.push(void 0);
          }
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    });
    textfield.onkeypress = function(event) {
      var char, diff, pos, r;
      if (word.is_deleted) {
        textfield.onkeypress = null;
        return true;
      }
      creator_token = true;
      char = null;
      if (event.keyCode === 13) {
        char = '\n';
      } else if (event.key != null) {
        if (event.charCode === 32) {
          char = " ";
        } else {
          char = event.key;
        }
      } else {
        char = window.String.fromCharCode(event.keyCode);
      }
      if (char.length > 1) {
        return true;
      } else if (char.length > 0) {
        r = createRange();
        pos = Math.min(r.left, r.right);
        diff = Math.abs(r.right - r.left);
        word["delete"](pos, diff);
        word.insert(pos, char);
        r.left = pos + char.length;
        r.right = r.left;
        writeRange(r);
      }
      event.preventDefault();
      creator_token = false;
      return false;
    };
    textfield.onpaste = function(event) {
      if (word.is_deleted) {
        textfield.onpaste = null;
        return true;
      }
      return event.preventDefault();
    };
    textfield.oncut = function(event) {
      if (word.is_deleted) {
        textfield.oncut = null;
        return true;
      }
      return event.preventDefault();
    };
    return textfield.onkeydown = function(event) {
      var del_length, diff, new_pos, pos, r, val;
      creator_token = true;
      if (word.is_deleted) {
        textfield.onkeydown = null;
        return true;
      }
      r = createRange();
      pos = Math.min(r.left, r.right, word.val().length);
      diff = Math.abs(r.left - r.right);
      if ((event.keyCode != null) && event.keyCode === 8) {
        if (diff > 0) {
          word["delete"](pos, diff);
          r.left = pos;
          r.right = pos;
          writeRange(r);
        } else {
          if ((event.ctrlKey != null) && event.ctrlKey) {
            val = word.val();
            new_pos = pos;
            del_length = 0;
            if (pos > 0) {
              new_pos--;
              del_length++;
            }
            while (new_pos > 0 && val[new_pos] !== " " && val[new_pos] !== '\n') {
              new_pos--;
              del_length++;
            }
            word["delete"](new_pos, pos - new_pos);
            r.left = new_pos;
            r.right = new_pos;
            writeRange(r);
          } else {
            if (pos > 0) {
              word["delete"](pos - 1, 1);
              r.left = pos - 1;
              r.right = pos - 1;
              writeRange(r);
            }
          }
        }
        event.preventDefault();
        creator_token = false;
        return false;
      } else if ((event.keyCode != null) && event.keyCode === 46) {
        if (diff > 0) {
          word["delete"](pos, diff);
          r.left = pos;
          r.right = pos;
          writeRange(r);
        } else {
          word["delete"](pos, 1);
          r.left = pos;
          r.right = pos;
          writeRange(r);
        }
        event.preventDefault();
        creator_token = false;
        return false;
      } else {
        creator_token = false;
        return true;
      }
    };
  };

  return YText;

})();

if (typeof window !== "undefined" && window !== null) {
  if (window.Y != null) {
    window.Y.Text = YText;
  } else {
    throw new Error("You must first import Y!");
  }
}

if (typeof module !== "undefined" && module !== null) {
  module.exports = YText;
}


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkg6XFxHaXRIdWJcXHktdGV4dFxcbm9kZV9tb2R1bGVzXFxndWxwLWJyb3dzZXJpZnlcXG5vZGVfbW9kdWxlc1xcYnJvd3NlcmlmeVxcbm9kZV9tb2R1bGVzXFxicm93c2VyLXBhY2tcXF9wcmVsdWRlLmpzIiwiSDpcXEdpdEh1YlxceS10ZXh0XFxsaWJcXHktdGV4dC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNLQSxJQUFBLEtBQUE7O0FBQUE7QUFNZSxFQUFBLGVBQUMsSUFBRCxHQUFBO0FBQ1gsSUFBQSxJQUFDLENBQUEsVUFBRCxHQUFjLEVBQWQsQ0FBQTtBQUNBLElBQUEsSUFBTyxZQUFQO0FBQ0UsTUFBQSxJQUFDLENBQUEsS0FBRCxHQUFTLEVBQVQsQ0FERjtLQUFBLE1BRUssSUFBRyxJQUFJLENBQUMsV0FBTCxLQUFvQixNQUF2QjtBQUNILE1BQUEsSUFBQyxDQUFBLEtBQUQsR0FBUyxJQUFULENBREc7S0FBQSxNQUFBO0FBR0gsWUFBVSxJQUFBLEtBQUEsQ0FBTSwwQ0FBTixDQUFWLENBSEc7S0FKTTtFQUFBLENBQWI7O0FBQUEsa0JBU0EsS0FBQSxHQUFPLE1BVFAsQ0FBQTs7QUFBQSxrQkFXQSxTQUFBLEdBQVcsU0FBQyxLQUFELEVBQVEsR0FBUixHQUFBO0FBQ1QsSUFBQSxJQUFPLG1CQUFQO0FBQ0UsTUFBQSxJQUFDLENBQUEsTUFBRCxHQUFjLElBQUEsR0FBRyxDQUFDLFdBQUosQ0FBZ0IsSUFBaEIsQ0FBa0IsQ0FBQyxPQUFuQixDQUFBLENBQWQsQ0FBQTtBQUFBLE1BQ0EsSUFBQyxDQUFBLE1BQUQsQ0FBUSxDQUFSLEVBQVcsSUFBQyxDQUFBLEtBQVosQ0FEQSxDQURGO0tBQUE7QUFBQSxJQUdBLE1BQUEsQ0FBQSxJQUFRLENBQUEsS0FIUixDQUFBO1dBSUEsSUFBQyxDQUFBLE9BTFE7RUFBQSxDQVhYLENBQUE7O0FBQUEsa0JBa0JBLFNBQUEsR0FBVyxTQUFFLE1BQUYsR0FBQTtBQUNULElBRFUsSUFBQyxD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RztPQXZDZTtJQUFBLEVBM0psQjtFQUFBLENBcEVOLENBQUE7O2VBQUE7O0lBTkYsQ0FBQTs7QUErUkEsSUFBRyxnREFBSDtBQUNFLEVBQUEsSUFBRyxnQkFBSDtBQUNFLElBQUEsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFULEdBQWdCLEtBQWhCLENBREY7R0FBQSxNQUFBO0FBR0UsVUFBVSxJQUFBLEtBQUEsQ0FBTSwwQkFBTixDQUFWLENBSEY7R0FERjtDQS9SQTs7QUFxU0EsSUFBRyxnREFBSDtBQUNFLEVBQUEsTUFBTSxDQUFDLE9BQVAsR0FBaUIsS0FBakIsQ0FERjtDQXJTQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJcclxuXHJcbiNcclxuIyBIYW5kbGVzIGEgU3RyaW5nLWxpa2UgZGF0YSBzdHJ1Y3R1cmVzIHdpdGggc3VwcG9ydCBmb3IgaW5zZXJ0L2RlbGV0ZSBhdCBhIHdvcmQtcG9zaXRpb24uXHJcbiNcclxuY2xhc3MgWVRleHRcclxuXHJcbiAgI1xyXG4gICMgQHByaXZhdGVcclxuICAjIEBwYXJhbSB7T2JqZWN0fSB1aWQgQSB1bmlxdWUgaWRlbnRpZmllci4gSWYgdWlkIGlzIHVuZGVmaW5lZCwgYSBuZXcgdWlkIHdpbGwgYmUgY3JlYXRlZC5cclxuICAjXHJcbiAgY29uc3RydWN0b3I6ICh0ZXh0KS0+XHJcbiAgICBAdGV4dGZpZWxkcyA9IFtdXHJcbiAgICBpZiBub3QgdGV4dD9cclxuICAgICAgQF90ZXh0ID0gXCJcIlxyXG4gICAgZWxzZSBpZiB0ZXh0LmNvbnN0cnVjdG9yIGlzIFN0cmluZ1xyXG4gICAgICBAX3RleHQgPSB0ZXh0XHJcbiAgICBlbHNlXHJcbiAgICAgIHRocm93IG5ldyBFcnJvciBcIlkuVGV4dCBleHBlY3RzIGEgU3RyaW5nIGFzIGEgY29uc3RydWN0b3JcIlxyXG5cclxuICBfbmFtZTogXCJUZXh0XCJcclxuXHJcbiAgX2dldE1vZGVsOiAodHlwZXMsIG9wcyktPlxyXG4gICAgaWYgbm90IEBfbW9kZWw/XHJcbiAgICAgIEBfbW9kZWwgPSBuZXcgb3BzLkxpc3RNYW5hZ2VyKEApLmV4ZWN1dGUoKVxyXG4gICAgICBAaW5zZXJ0IDAsIEBfdGV4dFxyXG4gICAgZGVsZXRlIEBfdGV4dFxyXG4gICAgQF9tb2RlbFxyXG5cclxuICBfc2V0TW9kZWw6IChAX21vZGVsKS0+XHJcbiAgICBkZWxldGUgQF90ZXh0XHJcblxyXG4gICNcclxuICAjIEdldCB0aGUgU3RyaW5nLXJlcHJlc2VudGF0aW9uIG9mIHRoaXMgd29yZC5cclxuICAjIEByZXR1cm4ge1N0cmluZ30gVGhlIFN0cmluZy1yZXByZXNlbnRhdGlvbiBvZiB0aGlzIG9iamVjdC5cclxuICAjXHJcbiAgdmFsOiAoKS0+XHJcbiAgICBAX21vZGVsLmZvbGQgXCJcIiwgKGxlZnQsIG8pLT5cclxuICAgICAgbGVmdCArIG8udmFsKClcclxuXHJcbiAgb2JzZXJ2ZTogKCktPlxyXG4gICAgQF9tb2RlbC5vYnNlcnZlLmFwcGx5IEBfbW9kZWwsIGFyZ3VtZW50c1xyXG5cclxuICB1bm9ic2VydmU6ICgpLT5cclxuICAgIEBfbW9kZWwudW5vYnNlcnZlLmFwcGx5IEBfbW9kZWwsIGFyZ3VtZW50c1xyXG5cclxuICAjXHJcbiAgIyBTYW1lIGFzIFN0cmluZy52YWxcclxuICAjIEBzZWUgU3RyaW5nLnZhbFxyXG4gICNcclxuICB0b1N0cmluZzogKCktPlxyXG4gICAgQHZhbCgpXHJcblxyXG4gICNcclxuICAjIEluc2VydHMgYSBzdHJpbmcgaW50byB0aGUgd29yZC5cclxuICAjXHJcbiAgIyBAcmV0dXJuIHtMaXN0TWFuYWdlciBUeXBlfSBUaGlzIFN0cmluZyBvYmplY3QuXHJcbiAgI1xyXG4gIGluc2VydDogKHBvc2l0aW9uLCBjb250ZW50KS0+XHJcbiAgICBpZiBjb250ZW50LmNvbnN0cnVjdG9yIGlzbnQgU3RyaW5nXHJcbiAgICAgIHRocm93IG5ldyBFcnJvciBcIlkuU3RyaW5nLmluc2VydCBleHBlY3RzIGEgU3RyaW5nIGFzIHRoZSBzZWNvbmQgcGFyYW1ldGVyIVwiXHJcbiAgICBpZiB0eXBlb2YgcG9zaXRpb24gaXNudCBcIm51bWJlclwiXHJcbiAgICAgIHRocm93IG5ldyBFcnJvciBcIlkuU3RyaW5nLmluc2VydCBleHBlY3RzIGEgTnVtYmVyIGFzIHRoZSBmaXJzdCBwYXJhbWV0ZXIhXCJcclxuICAgIGlmIGNvbnRlbnQubGVuZ3RoID4gMFxyXG4gICAgICBpdGggPSBAX21vZGVsLmdldE9wZXJhdGlvbkJ5UG9zaXRpb24gcG9zaXRpb25cclxuICAgICAgIyB0aGUgKGktMSl0aCBjaGFyYWN0ZXIuIGUuZy4gXCJhYmNcIiB0aGUgMXRoIGNoYXJhY3RlciBpcyBcImFcIlxyXG4gICAgICAjIHRoZSAwdGggY2hhcmFjdGVyIGlzIHRoZSBsZWZ0IERlbGltaXRlclxyXG4gICAgICBAX21vZGVsLmluc2VydEFmdGVyIGl0aCwgY29udGVudFxyXG5cclxuICBkZWxldGU6IChwb3NpdGlvbiwgbGVuZ3RoKS0+XHJcbiAgICBAX21vZGVsLmRlbGV0ZSBwb3NpdGlvbiwgbGVuZ3RoXHJcblxyXG4gICNcclxuICAjIEJpbmQgdGhpcyBTdHJpbmcgdG8gYSB0ZXh0ZmllbGQgb3IgaW5wdXQgZmllbGQuXHJcbiAgI1xyXG4gICMgQGV4YW1wbGVcclxuICAjICAgdmFyIHRleHRib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRleHRmaWVsZFwiKTtcclxuICAjICAgeS5iaW5kKHRleHRib3gpO1xyXG4gICNcclxuICBiaW5kOiAodGV4dGZpZWxkLCBkb21fcm9vdCktPlxyXG4gICAgZG9tX3Jvb3QgPz0gd2luZG93XHJcbiAgICBpZiAobm90IGRvbV9yb290LmdldFNlbGVjdGlvbj8pXHJcbiAgICAgIGRvbV9yb290ID0gd2luZG93XHJcblxyXG4gICAgIyBkb24ndCBkdXBsaWNhdGUhXHJcbiAgICBmb3IgdCBpbiBAdGV4dGZpZWxkc1xyXG4gICAgICBpZiB0IGlzIHRleHRmaWVsZFxyXG4gICAgICAgIHJldHVyblxyXG4gICAgY3JlYXRvcl90b2tlbiA9IGZhbHNlO1xyXG5cclxuICAgIHdvcmQgPSBAXHJcbiAgICB0ZXh0ZmllbGQudmFsdWUgPSBAdmFsKClcclxuICAgIEB0ZXh0ZmllbGRzLnB1c2ggdGV4dGZpZWxkXHJcblxyXG4gICAgaWYgdGV4dGZpZWxkLnNlbGVjdGlvblN0YXJ0PyBhbmQgdGV4dGZpZWxkLnNldFNlbGVjdGlvblJhbmdlP1xyXG4gICAgICBjcmVhdGVSYW5nZSA9IChmaXgpLT5cclxuICAgICAgICBsZWZ0ID0gdGV4dGZpZWxkLnNlbGVjdGlvblN0YXJ0XHJcbiAgICAgICAgcmlnaHQgPSB0ZXh0ZmllbGQuc2VsZWN0aW9uRW5kXHJcbiAgICAgICAgaWYgZml4P1xyXG4gICAgICAgICAgbGVmdCA9IGZpeCBsZWZ0XHJcbiAgICAgICAgICByaWdodCA9IGZpeCByaWdodFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGxlZnQ6IGxlZnRcclxuICAgICAgICAgIHJpZ2h0OiByaWdodFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIHdyaXRlUmFuZ2UgPSAocmFuZ2UpLT5cclxuICAgICAgICB3cml0ZUNvbnRlbnQgd29yZC52YWwoKVxyXG4gICAgICAgIHRleHRmaWVsZC5zZXRTZWxlY3Rpb25SYW5nZSByYW5nZS5sZWZ0LCByYW5nZS5yaWdodFxyXG5cclxuICAgICAgd3JpdGVDb250ZW50ID0gKGNvbnRlbnQpLT5cclxuICAgICAgICB0ZXh0ZmllbGQudmFsdWUgPSBjb250ZW50XHJcbiAgICBlbHNlXHJcbiAgICAgIGNyZWF0ZVJhbmdlID0gKGZpeCktPlxyXG4gICAgICAgIHJhbmdlID0ge31cclxuICAgICAgICBzID0gZG9tX3Jvb3QuZ2V0U2VsZWN0aW9uKClcclxuICAgICAgICBjbGVuZ3RoID0gdGV4dGZpZWxkLnRleHRDb250ZW50Lmxlbmd0aFxyXG4gICAgICAgIHJhbmdlLmxlZnQgPSBNYXRoLm1pbiBzLmFuY2hvck9mZnNldCwgY2xlbmd0aFxyXG4gICAgICAgIHJhbmdlLnJpZ2h0ID0gTWF0aC5taW4gcy5mb2N1c09mZnNldCwgY2xlbmd0aFxyXG4gICAgICAgIGlmIGZpeD9cclxuICAgICAgICAgIHJhbmdlLmxlZnQgPSBmaXggcmFuZ2UubGVmdFxyXG4gICAgICAgICAgcmFuZ2UucmlnaHQgPSBmaXggcmFuZ2UucmlnaHRcclxuXHJcbiAgICAgICAgZWRpdGVkX2VsZW1lbnQgPSBzLmZvY3VzTm9kZVxyXG4gICAgICAgIGlmIGVkaXRlZF9lbGVtZW50IGlzIHRleHRmaWVsZCBvciBlZGl0ZWRfZWxlbWVudCBpcyB0ZXh0ZmllbGQuY2hpbGROb2Rlc1swXVxyXG4gICAgICAgICAgcmFuZ2UuaXNSZWFsID0gdHJ1ZVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgIHJhbmdlLmlzUmVhbCA9IGZhbHNlXHJcbiAgICAgICAgcmFuZ2VcclxuXHJcbiAgICAgIHdyaXRlUmFuZ2UgPSAocmFuZ2UpLT5cclxuICAgICAgICB3cml0ZUNvbnRlbnQgd29yZC52YWwoKVxyXG4gICAgICAgIHRleHRub2RlID0gdGV4dGZpZWxkLmNoaWxkTm9kZXNbMF1cclxuICAgICAgICBpZiByYW5nZS5pc1JlYWwgYW5kIHRleHRub2RlP1xyXG4gICAgICAgICAgaWYgcmFuZ2UubGVmdCA8IDBcclxuICAgICAgICAgICAgcmFuZ2UubGVmdCA9IDBcclxuICAgICAgICAgIHJhbmdlLnJpZ2h0ID0gTWF0aC5tYXggcmFuZ2UubGVmdCwgcmFuZ2UucmlnaHRcclxuICAgICAgICAgIGlmIHJhbmdlLnJpZ2h0ID4gdGV4dG5vZGUubGVuZ3RoXHJcbiAgICAgICAgICAgIHJhbmdlLnJpZ2h0ID0gdGV4dG5vZGUubGVuZ3RoXHJcbiAgICAgICAgICByYW5nZS5sZWZ0ID0gTWF0aC5taW4gcmFuZ2UubGVmdCwgcmFuZ2UucmlnaHRcclxuICAgICAgICAgIHIgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpXHJcbiAgICAgICAgICByLnNldFN0YXJ0KHRleHRub2RlLCByYW5nZS5sZWZ0KVxyXG4gICAgICAgICAgci5zZXRFbmQodGV4dG5vZGUsIHJhbmdlLnJpZ2h0KVxyXG4gICAgICAgICAgcyA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKVxyXG4gICAgICAgICAgcy5yZW1vdmVBbGxSYW5nZXMoKVxyXG4gICAgICAgICAgcy5hZGRSYW5nZShyKVxyXG4gICAgICB3cml0ZUNvbnRlbnQgPSAoY29udGVudCktPlxyXG4gICAgICAgIGNvbnRlbnRfYXJyYXkgPSBjb250ZW50LnJlcGxhY2UobmV3IFJlZ0V4cChcIlxcblwiLCdnJyksXCIgXCIpLnNwbGl0KFwiIFwiKVxyXG4gICAgICAgIHRleHRmaWVsZC5pbm5lclRleHQgPSBcIlwiXHJcbiAgICAgICAgZm9yIGMsIGkgaW4gY29udGVudF9hcnJheVxyXG4gICAgICAgICAgdGV4dGZpZWxkLmlubmVyVGV4dCArPSBjXHJcbiAgICAgICAgICBpZiBpIGlzbnQgY29udGVudF9hcnJheS5sZW5ndGgtMVxyXG4gICAgICAgICAgICB0ZXh0ZmllbGQuaW5uZXJIVE1MICs9ICcmbmJzcDsnXHJcblxyXG4gICAgd3JpdGVDb250ZW50IHRoaXMudmFsKClcclxuXHJcbiAgICBAb2JzZXJ2ZSAoZXZlbnRzKS0+XHJcbiAgICAgIGZvciBldmVudCBpbiBldmVudHNcclxuICAgICAgICBpZiBub3QgY3JlYXRvcl90b2tlblxyXG4gICAgICAgICAgaWYgZXZlbnQudHlwZSBpcyBcImluc2VydFwiXHJcbiAgICAgICAgICAgIG9fcG9zID0gZXZlbnQucG9zaXRpb25cclxuICAgICAgICAgICAgZml4ID0gKGN1cnNvciktPlxyXG4gICAgICAgICAgICAgIGlmIGN1cnNvciA8PSBvX3Bvc1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yXHJcbiAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgY3Vyc29yICs9IDFcclxuICAgICAgICAgICAgICAgIGN1cnNvclxyXG4gICAgICAgICAgICByID0gY3JlYXRlUmFuZ2UgZml4XHJcbiAgICAgICAgICAgIHdyaXRlUmFuZ2UgclxyXG5cclxuICAgICAgICAgIGVsc2UgaWYgZXZlbnQudHlwZSBpcyBcImRlbGV0ZVwiXHJcbiAgICAgICAgICAgIG9fcG9zID0gZXZlbnQucG9zaXRpb25cclxuICAgICAgICAgICAgZml4ID0gKGN1cnNvciktPlxyXG4gICAgICAgICAgICAgIGlmIGN1cnNvciA8IG9fcG9zXHJcbiAgICAgICAgICAgICAgICBjdXJzb3JcclxuICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBjdXJzb3IgLT0gMVxyXG4gICAgICAgICAgICAgICAgY3Vyc29yXHJcbiAgICAgICAgICAgIHIgPSBjcmVhdGVSYW5nZSBmaXhcclxuICAgICAgICAgICAgd3JpdGVSYW5nZSByXHJcblxyXG4gICAgIyBjb25zdW1lIGFsbCB0ZXh0LWluc2VydCBjaGFuZ2VzLlxyXG4gICAgdGV4dGZpZWxkLm9ua2V5cHJlc3MgPSAoZXZlbnQpLT5cclxuICAgICAgaWYgd29yZC5pc19kZWxldGVkXHJcbiAgICAgICAgIyBpZiB3b3JkIGlzIGRlbGV0ZWQsIGRvIG5vdCBkbyBhbnl0aGluZyBldmVyIGFnYWluXHJcbiAgICAgICAgdGV4dGZpZWxkLm9ua2V5cHJlc3MgPSBudWxsXHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgY3JlYXRvcl90b2tlbiA9IHRydWVcclxuICAgICAgY2hhciA9IG51bGxcclxuICAgICAgaWYgZXZlbnQua2V5Q29kZSBpcyAxM1xyXG4gICAgICAgIGNoYXIgPSAnXFxuJ1xyXG4gICAgICBlbHNlIGlmIGV2ZW50LmtleT9cclxuICAgICAgICBpZiBldmVudC5jaGFyQ29kZSBpcyAzMlxyXG4gICAgICAgICAgY2hhciA9IFwiIFwiXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgY2hhciA9IGV2ZW50LmtleVxyXG4gICAgICBlbHNlXHJcbiAgICAgICAgY2hhciA9IHdpbmRvdy5TdHJpbmcuZnJvbUNoYXJDb2RlIGV2ZW50LmtleUNvZGVcclxuICAgICAgaWYgY2hhci5sZW5ndGggPiAxXHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgZWxzZSBpZiBjaGFyLmxlbmd0aCA+IDBcclxuICAgICAgICByID0gY3JlYXRlUmFuZ2UoKVxyXG4gICAgICAgIHBvcyA9IE1hdGgubWluIHIubGVmdCwgci5yaWdodFxyXG4gICAgICAgIGRpZmYgPSBNYXRoLmFicyhyLnJpZ2h0IC0gci5sZWZ0KVxyXG4gICAgICAgIHdvcmQuZGVsZXRlIHBvcywgZGlmZlxyXG4gICAgICAgIHdvcmQuaW5zZXJ0IHBvcywgY2hhclxyXG4gICAgICAgIHIubGVmdCA9IHBvcyArIGNoYXIubGVuZ3RoXHJcbiAgICAgICAgci5yaWdodCA9IHIubGVmdFxyXG4gICAgICAgIHdyaXRlUmFuZ2UgclxyXG5cclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxyXG4gICAgICBjcmVhdG9yX3Rva2VuID0gZmFsc2VcclxuICAgICAgZmFsc2VcclxuXHJcbiAgICB0ZXh0ZmllbGQub25wYXN0ZSA9IChldmVudCktPlxyXG4gICAgICBpZiB3b3JkLmlzX2RlbGV0ZWRcclxuICAgICAgICAjIGlmIHdvcmQgaXMgZGVsZXRlZCwgZG8gbm90IGRvIGFueXRoaW5nIGV2ZXIgYWdhaW5cclxuICAgICAgICB0ZXh0ZmllbGQub25wYXN0ZSA9IG51bGxcclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICB0ZXh0ZmllbGQub25jdXQgPSAoZXZlbnQpLT5cclxuICAgICAgaWYgd29yZC5pc19kZWxldGVkXHJcbiAgICAgICAgIyBpZiB3b3JkIGlzIGRlbGV0ZWQsIGRvIG5vdCBkbyBhbnl0aGluZyBldmVyIGFnYWluXHJcbiAgICAgICAgdGV4dGZpZWxkLm9uY3V0ID0gbnVsbFxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcclxuXHJcbiAgICAjXHJcbiAgICAjIGNvbnN1bWUgZGVsZXRlcy4gTm90ZSB0aGF0XHJcbiAgICAjICAgY2hyb21lOiB3b24ndCBjb25zdW1lIGRlbGV0aW9ucyBvbiBrZXlwcmVzcyBldmVudC5cclxuICAgICMgICBrZXlDb2RlIGlzIGRlcHJlY2F0ZWQuIEJVVDogSSBkb24ndCBzZWUgYW5vdGhlciB3YXkuXHJcbiAgICAjICAgICBzaW5jZSBldmVudC5rZXkgaXMgbm90IGltcGxlbWVudGVkIGluIHRoZSBjdXJyZW50IHZlcnNpb24gb2YgY2hyb21lLlxyXG4gICAgIyAgICAgRXZlcnkgYnJvd3NlciBzdXBwb3J0cyBrZXlDb2RlLiBMZXQncyBzdGljayB3aXRoIGl0IGZvciBub3cuLlxyXG4gICAgI1xyXG4gICAgdGV4dGZpZWxkLm9ua2V5ZG93biA9IChldmVudCktPlxyXG4gICAgICBjcmVhdG9yX3Rva2VuID0gdHJ1ZVxyXG4gICAgICBpZiB3b3JkLmlzX2RlbGV0ZWRcclxuICAgICAgICAjIGlmIHdvcmQgaXMgZGVsZXRlZCwgZG8gbm90IGRvIGFueXRoaW5nIGV2ZXIgYWdhaW5cclxuICAgICAgICB0ZXh0ZmllbGQub25rZXlkb3duID0gbnVsbFxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICAgIHIgPSBjcmVhdGVSYW5nZSgpXHJcbiAgICAgIHBvcyA9IE1hdGgubWluKHIubGVmdCwgci5yaWdodCwgd29yZC52YWwoKS5sZW5ndGgpXHJcbiAgICAgIGRpZmYgPSBNYXRoLmFicyhyLmxlZnQgLSByLnJpZ2h0KVxyXG4gICAgICBpZiBldmVudC5rZXlDb2RlPyBhbmQgZXZlbnQua2V5Q29kZSBpcyA4ICMgQmFja3NwYWNlXHJcbiAgICAgICAgaWYgZGlmZiA+IDBcclxuICAgICAgICAgIHdvcmQuZGVsZXRlIHBvcywgZGlmZlxyXG4gICAgICAgICAgci5sZWZ0ID0gcG9zXHJcbiAgICAgICAgICByLnJpZ2h0ID0gcG9zXHJcbiAgICAgICAgICB3cml0ZVJhbmdlIHJcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICBpZiBldmVudC5jdHJsS2V5PyBhbmQgZXZlbnQuY3RybEtleVxyXG4gICAgICAgICAgICB2YWwgPSB3b3JkLnZhbCgpXHJcbiAgICAgICAgICAgIG5ld19wb3MgPSBwb3NcclxuICAgICAgICAgICAgZGVsX2xlbmd0aCA9IDBcclxuICAgICAgICAgICAgaWYgcG9zID4gMFxyXG4gICAgICAgICAgICAgIG5ld19wb3MtLVxyXG4gICAgICAgICAgICAgIGRlbF9sZW5ndGgrK1xyXG4gICAgICAgICAgICB3aGlsZSBuZXdfcG9zID4gMCBhbmQgdmFsW25ld19wb3NdIGlzbnQgXCIgXCIgYW5kIHZhbFtuZXdfcG9zXSBpc250ICdcXG4nXHJcbiAgICAgICAgICAgICAgbmV3X3Bvcy0tXHJcbiAgICAgICAgICAgICAgZGVsX2xlbmd0aCsrXHJcbiAgICAgICAgICAgIHdvcmQuZGVsZXRlIG5ld19wb3MsIChwb3MtbmV3X3BvcylcclxuICAgICAgICAgICAgci5sZWZ0ID0gbmV3X3Bvc1xyXG4gICAgICAgICAgICByLnJpZ2h0ID0gbmV3X3Bvc1xyXG4gICAgICAgICAgICB3cml0ZVJhbmdlIHJcclxuICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgaWYgcG9zID4gMFxyXG4gICAgICAgICAgICAgIHdvcmQuZGVsZXRlIChwb3MtMSksIDFcclxuICAgICAgICAgICAgICByLmxlZnQgPSBwb3MtMVxyXG4gICAgICAgICAgICAgIHIucmlnaHQgPSBwb3MtMVxyXG4gICAgICAgICAgICAgIHdyaXRlUmFuZ2UgclxyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcclxuICAgICAgICBjcmVhdG9yX3Rva2VuID0gZmFsc2VcclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgZWxzZSBpZiBldmVudC5rZXlDb2RlPyBhbmQgZXZlbnQua2V5Q29kZSBpcyA0NiAjIERlbGV0ZVxyXG4gICAgICAgIGlmIGRpZmYgPiAwXHJcbiAgICAgICAgICB3b3JkLmRlbGV0ZSBwb3MsIGRpZmZcclxuICAgICAgICAgIHIubGVmdCA9IHBvc1xyXG4gICAgICAgICAgci5yaWdodCA9IHBvc1xyXG4gICAgICAgICAgd3JpdGVSYW5nZSByXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgd29yZC5kZWxldGUgcG9zLCAxXHJcbiAgICAgICAgICByLmxlZnQgPSBwb3NcclxuICAgICAgICAgIHIucmlnaHQgPSBwb3NcclxuICAgICAgICAgIHdyaXRlUmFuZ2UgclxyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcclxuICAgICAgICBjcmVhdG9yX3Rva2VuID0gZmFsc2VcclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgZWxzZVxyXG4gICAgICAgIGNyZWF0b3JfdG9rZW4gPSBmYWxzZVxyXG4gICAgICAgIHRydWVcclxuXHJcblxyXG5pZiB3aW5kb3c/XHJcbiAgaWYgd2luZG93Llk/XHJcbiAgICB3aW5kb3cuWS5UZXh0ID0gWVRleHRcclxuICBlbHNlXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IgXCJZb3UgbXVzdCBmaXJzdCBpbXBvcnQgWSFcIlxyXG5cclxuaWYgbW9kdWxlP1xyXG4gIG1vZHVsZS5leHBvcnRzID0gWVRleHRcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiJdfQ==
